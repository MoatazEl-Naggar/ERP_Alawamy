generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  ACCOUNTANT
  EMPLOYEE
}

model User {
  id           String   @id @default(uuid())
  username     String   @unique
  passwordHash String
  role         UserRole @default(EMPLOYEE)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())

  permissions Permission[]
}

model Permission {
  id        String  @id @default(uuid())
  userId    String
  screen    String
  canView   Boolean @default(false)
  canAdd    Boolean @default(false)
  canEdit   Boolean @default(false)
  canDelete Boolean @default(false)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, screen])
}

model Customer {
  id             String   @id @default(uuid())
  customerNumber String   @unique
  name           String
  phone          String?
  address        String?
  email          String?
  accountNumber  String?
  createdAt      DateTime @default(now())

  shipments        Shipment[]
  receiptVouchers  ReceiptVoucher[]
  paymentVouchers  PaymentVoucher[]
}

model Supplier {
  id             String   @id @default(uuid())
  supplierNumber String   @unique
  name           String
  phone          String?
  address        String?
  email          String?
  accountNumber  String?
  createdAt      DateTime @default(now())

  purchaseInvoices PurchaseInvoice[]
  receiptVouchers  ReceiptVoucher[]
  paymentVouchers  PaymentVoucher[]
}

model ExpenseCategory {
  id        String   @id @default(uuid())
  number    Int      @unique
  name      String
  type      String
  createdAt DateTime @default(now())

  paymentVouchers PaymentVoucher[]
  receiptVouchers ReceiptVoucher[]
}

model Treasury {
  id        String   @id @default(uuid())
  name      String
  balance   Float    @default(0)
  createdAt DateTime @default(now())

  receipts ReceiptVoucher[]
  payments PaymentVoucher[]
}

model ReceiptVoucher {
  id                String   @id @default(uuid())
  voucherNumber     String
  date              DateTime
  treasuryId        String
  expenseCategoryId String?
  amount            Float
  costPrice         Float?
  description       String?
  receivedFrom      String?
  notes             String?
  currency          String   @default("جنيه")
  exchangeRate      Float    @default(1)
  shipmentId        String?
  customerId        String?
  supplierId        String?
  createdAt         DateTime @default(now())

  treasury        Treasury         @relation(fields: [treasuryId], references: [id], onDelete: Restrict)
  expenseCategory ExpenseCategory? @relation(fields: [expenseCategoryId], references: [id], onDelete: SetNull)
  shipment        Shipment?        @relation(fields: [shipmentId], references: [id], onDelete: SetNull)
  customer        Customer?        @relation(fields: [customerId], references: [id], onDelete: SetNull)
  supplier        Supplier?        @relation(fields: [supplierId], references: [id], onDelete: SetNull)
}

model PaymentVoucher {
  id                String   @id @default(uuid())
  voucherNumber     String
  date              DateTime
  treasuryId        String
  expenseCategoryId String?
  amount            Float
  costPrice         Float?
  description       String?
  paidTo            String?
  notes             String?
  currency          String   @default("جنيه")
  exchangeRate      Float    @default(1)
  shipmentId        String?
  customerId        String?
  supplierId        String?
  createdAt         DateTime @default(now())

  treasury        Treasury         @relation(fields: [treasuryId], references: [id], onDelete: Restrict)
  expenseCategory ExpenseCategory? @relation(fields: [expenseCategoryId], references: [id], onDelete: SetNull)
  shipment        Shipment?        @relation(fields: [shipmentId], references: [id], onDelete: SetNull)
  customer        Customer?        @relation(fields: [customerId], references: [id], onDelete: SetNull)
  supplier        Supplier?        @relation(fields: [supplierId], references: [id], onDelete: SetNull)
}

model Currency {
  id           String   @id @default(uuid())
  name         String   @unique
  exchangeRate Float    @default(1)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model PurchaseInvoice {
  id            String   @id @default(uuid())
  invoiceNumber String
  referenceNo   String?
  date          DateTime
  supplierId    String
  notes         String?
  createdAt     DateTime @default(now())

  supplier   Supplier           @relation(fields: [supplierId], references: [id], onDelete: Restrict)
  items      PurchaseItem[]
  receivings ReceivingInvoice[]

  @@unique([invoiceNumber, supplierId])
}

model PurchaseItem {
  id         String   @id @default(uuid())
  invoiceId  String
  itemName   String
  barcode    String?
  quantity   Int      @default(0)
  unitPrice  Float    @default(0)
  qtyCartons Int?
  qtyUnits   Int?
  price      Float?
  total      Float?
  cbm        Float?
  weight     Float?
  discount   Float?
  createdAt  DateTime @default(now())

  invoice        PurchaseInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  receivingItems ReceivingItem[]
}

model ReceivingInvoice {
  id            String   @id @default(uuid())
  invoiceNumber String   @unique
  date          DateTime
  purchaseId    String
  notes         String?
  createdAt     DateTime @default(now())

  purchase PurchaseInvoice @relation(fields: [purchaseId], references: [id], onDelete: Restrict)
  items    ReceivingItem[]
}

model ReceivingItem {
  id              String   @id @default(uuid())
  receivingId     String
  purchaseItemId  String
  receivedUnits   Int
  receivedCartons Int?
  damagedUnits    Int?
  notes           String?
  createdAt       DateTime @default(now())

  receivingInvoice ReceivingInvoice @relation(fields: [receivingId], references: [id], onDelete: Cascade)
  purchaseItem     PurchaseItem     @relation(fields: [purchaseItemId], references: [id], onDelete: Restrict)
  shipmentItems    ShipmentItem[]
}

model ItemRegistration {
  id          String   @id @default(uuid())
  itemName    String   @unique
  barcode     String   @unique
  description String?
  createdAt   DateTime @default(now())
}

model InventoryItem {
  id            String   @id @default(uuid())
  itemName      String   @unique
  barcode       String   @unique
  totalReceived Int      @default(0)
  totalShipped  Int      @default(0)
  balance       Int      @default(0)
  createdAt     DateTime @default(now())
}

model Container {
  id              String    @id @default(uuid())
  containerNumber String    @unique
  containerType   String    @default("standard")
  date            DateTime?
  notes           String?
  createdAt       DateTime  @default(now())

  shipments Shipment[]
}

model Shipment {
  id              String   @id @default(uuid())
  referenceNo     String   @unique
  containerNo     String?
  containerId     String?
  date            DateTime
  customerId      String
  shippingCompany String?
  notes           String?
  createdAt       DateTime @default(now())

  customer        Customer         @relation(fields: [customerId], references: [id], onDelete: Restrict)
  container       Container?       @relation(fields: [containerId], references: [id], onDelete: Restrict)
  items           ShipmentItem[]
  receiptVouchers ReceiptVoucher[]
  paymentVouchers PaymentVoucher[]
}

model ShipmentItem {
  id              String   @id @default(uuid())
  shipmentId      String
  receivingItemId String
  shippedUnits    Int
  shippedCartons  Int?
  createdAt       DateTime @default(now())

  shipment      Shipment      @relation(fields: [shipmentId], references: [id], onDelete: Cascade)
  receivingItem ReceivingItem @relation(fields: [receivingItemId], references: [id], onDelete: Restrict)
}